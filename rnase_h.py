from typing import Dict

# Log2 Fold-Changes
# Dinucleotide model
R7_di = [
    {'AA': 0.009081411, 'AC': 0.035017676, 'AG': -0.084497637, 'AU': 0.045971299, 'CA': 0.008389612, 'CC': 0.012593763, 'CG': -0.064891784, 'CU': 0.044395592, 'GA': 0.016382139, 'GC': 0.009503221, 'GG': -0.121551835, 'GU': 0.01184916, 'UA': 0.060507082, 'UC': 0.047997697, 'UG': -0.028551982, 'UU': 0.075586262},
    {'AA': 0.087778434, 'AC': 0.033503366, 'AG': -0.069390977, 'AU': 0.030973446, 'CA': 0.092189709, 'CC': -0.002411931, 'CG': -0.04474141, 'CU': 0.027324876, 'GA': 0.030309937, 'GC': -0.064815252, 'GG': -0.216446123, 'GU': -0.082920407, 'UA': 0.098414385, 'UC': 0.060325751, 'UG': -0.061329424, 'UU': 0.068103273},
    {'AA': 0.154159324, 'AC': 0.073575187, 'AG': -0.002043154, 'AU': 0.050978338, 'CA': 0.057132147, 'CC': -0.040929122, 'CG': -0.010070678, 'CU': -0.003589745, 'GA': -0.045976887, 'GC': -0.070268435, 'GG': -0.20757596, 'GU': -0.121300976, 'UA': 0.048197099, 'UC': 0.029055058, 'UG': -0.067021223, 'UU': -0.005930056},
    {'AA': 0.09141531, 'AC': 0.07572152, 'AG': 0.01119738, 'AU': 0.03572171, 'CA': -0.03544149, 'CC': 0.04824559, 'CG': -0.03993763, 'CU': 0.04495715, 'GA': -0.09743956, 'GC': -0.04083228, 'GG': -0.14751025, 'GU': -0.05610021, 'UA': -0.06980566, 'UC': 0.04234167, 'UG': -0.07699481, 'UU': 0.03129569},
    {'AA': 0.0029742, 'AC': -0.006389322, 'AG': -0.023798874, 'AU': -0.035385509, 'CA': -0.036685202, 'CC': 0.076564814, 'CG': 0.030321195, 'CU': 0.070275125, 'GA': -0.09952783, 'GC': -0.050954636, 'GG': -0.028349851, 'GU': -0.033219176, 'UA': -0.04116122, 'UC': 0.032044778, 'UG': 0.002964694, 'UU': 0.090986229},
    {'AA': -0.050968079, 'AC': -0.060141008, 'AG': -0.013266516, 'AU': -0.001174494, 'CA': -0.06395038, 'CC': 0.014287539, 'CG': 0.025332536, 'CU': 0.09831353, 'GA': -0.048026708, 'GC': -0.055066878, 'GG': 0.031811408, 'GU': 0.101497182, 'UA': -0.049054633, 'UC': -0.033002797, 'UG': 0.025995407, 'UU': 0.170092685},
    {'AA': -0.080101303, 'AC': -0.05010873, 'AG': -0.022619033, 'AU': -0.050685047, 'CA': -0.125153888, 'CC': 0.041989015, 'CG': -0.016425931, 'CU': -0.008604034, 'GA': -0.079382144, 'GC': 0.048826935, 'GG': -0.001523036, 'GU': 0.060215168, 'UA': 0.038531065, 'UC': 0.067977716, 'UG': 0.122281992, 'UU': 0.143294716},
    {'AA': -0.103107912, 'AC': -0.058971992, 'AG': -0.054198475, 'AU': -0.029060379, 'CA': -0.001004514, 'CC': 0.035681438, 'CG': 0.019051606, 'CU': 0.052594728, 'GA': -0.015967358, 'GC': 0.011534141, 'GG': 0.037665588, 'GU': 0.055946057, 'UA': 0.012981482, 'UC': 0.0050741, 'UG': 0.027539061, 'UU': 0.081620065},
    {'AA': -0.031777122, 'AC': -0.049130859, 'AG': -0.092043541, 'AU': 0.024231604, 'CA': -0.009623127, 'CC': 0.002130942, 'CG': -0.05506201, 'CU': 0.027359893, 'GA': -0.004537817, 'GC': -0.00650564, 'GG': 0.005285288, 'GU': 0.022295787, 'UA': 0.037555698, 'UC': 0.019220529, 'UG': -0.008035706, 'UU': 0.078419051},
    {'AA': -0.017510513, 'AC': 0.011343901, 'AG': 0.008640449, 'AU': -0.013966992, 'CA': -0.017279695, 'CC': 0.00874438, 'CG': -0.005866804, 'CU': -0.025314094, 'GA': -0.04537268, 'GC': -0.049393756, 'GG': -0.021653404, 'GU': -0.060448133, 'UA': 0.044343643, 'UC': 0.045840932, 'UG': 0.041132195, 'UU': 0.018446183},
    {'AA': -0.003311804, 'AC': -0.008194199, 'AG': -0.005257091, 'AU': -0.001472181, 'CA': 0.01537106, 'CC': 0.01106004, 'CG': 0.00006099463, 'CU': 0.01013069, 'GA': 0.01044087, 'GC': -0.007814353, 'GG': 0.0241815, 'GU': 0.006750387, 'UA': -0.0005605312, 'UC': -0.02911119, 'UG': -0.02272423, 'UU': -0.01641414},
    {'AA': 0.0076069668, 'AC': 0.0003573288, 'AG': -0.000887778, 'AU': 0.0121823483, 'CA': -0.0068331432, 'CC': -0.0008588512, 'CG': -0.025199587, 'CU': 0.0041068407, 'GA': 0.0001706517, 'GC': -0.0097036366, 'GG': -0.0029630626, 'GU': 0.0154803538, 'UA': 0.0053266615, 'UC': -0.0063194866, 'UG': -0.0037404939, 'UU': 0.0018708447},
]

# Log2 Fold-Changes
# Dinucleotide model
R4a_di = [
    {'AA': -0.011145051, 'AC': -0.004447214, 'AG': -0.011652815, 'AU': -0.014661642, 'CA': 0.020816251, 'CC': 0.011068607, 'CG': 0.002897998, 'CU': 0.015692507, 'GA': -0.015326425, 'GC': -0.008938635, 'GG': 0.00506995, 'GU': 0.011026739, 'UA': 0.015878317, 'UC': -0.022119476, 'UG': 0.009728738, 'UU': 0.00472374},
    {'AA': -0.0060674807, 'AC': -0.0088663724, 'AG': 0.0124122123, 'AU': 0.0139367225, 'CA': -0.0085669628, 'CC': -0.0124800934, 'CG': -0.0098001584, 'CU': 0.0196403338, 'GA': -0.0004736115, 'GC': -0.0223477099, 'GG': 0.0106067648, 'GU': 0.0023532899, 'UA': 0.0029391821, 'UC': -0.0205156224, 'UG': 0.0152387464, 'UU': -0.0033315687},
    {'AA': -0.0078905381, 'AC': 0.0211283351, 'AG': -0.042339535, 'AU': 0.0481284612, 'CA': -0.0076516683, 'CC': 0.0001568862, 'CG': -0.0571286501, 'CU': 0.0412322071, 'GA': 0.0263033928, 'GC': 0.0261286198, 'GG': -0.0395589156, 'GU': 0.0556415535, 'UA': 0.0168058448, 'UC': 0.0282314831, 'UG': -0.0407775292, 'UU': 0.0668397698},
    {'AA': 0, 'AC': 0, 'AG': 0.007717149, 'AU': 0, 'CA': 0, 'CC': 0, 'CG': 0.020966283, 'CU': 0, 'GA': 0, 'GC': 0, 'GG': -0.044062832, 'GU': 0, 'UA': 0, 'UC': 0, 'UG': 0.052261172, 'UU': 0},
    {'AA': 0, 'AC': 0, 'AG': 0, 'AU': 0, 'CA': 0, 'CC': 0, 'CG': 0, 'CU': 0, 'GA': 0, 'GC': 1.800497E-15, 'GG': 0, 'GU': 0, 'UA': 0, 'UC': 0, 'UG': 0, 'UU': 0},
    {'AA': 0, 'AC': 0, 'AG': 0, 'AU': 0, 'CA': -0.01667931, 'CC': 0.06663685, 'CG': -0.01225109, 'CU': 0.02785783, 'GA': 0, 'GC': 0, 'GG': 0, 'GU': 0, 'UA': 0, 'UC': 0, 'UG': 0, 'UU': 0},
    {'AA': -0.07337747, 'AC': 0.07088278, 'AG': 0.02535729, 'AU': -0.05891855, 'CA': -0.01899446, 'CC': 0.23241208, 'CG': 0.11504828, 'CU': 0.05687383, 'GA': -0.12058821, 'GC': 0.03592721, 'GG': 0.03770482, 'GU': -0.03902255, 'UA': -0.03057776, 'UC': 0.10451626, 'UG': 0.09233641, 'UU': -0.02119269},
    {'AA': -0.06851626, 'AC': -0.1525785, 'AG': -0.04410562, 'AU': -0.01396531, 'CA': 0.02661876, 'CC': -0.02829809, 'CG': 0.048322, 'CU': 0.1748351, 'GA': 0.04786808, 'GC': -0.08329603, 'GG': 0.14672315, 'GU': 0.135601, 'UA': -0.08951474, 'UC': -0.12514098, 'UG': -0.04319589, 'UU': 0.09665211},
    {'AA': -0.010306159, 'AC': -0.044078913, 'AG': 0.036961377, 'AU': -0.014798928, 'CA': -0.197637331, 'CC': 0.008031078, 'CG': -0.023436983, 'CU': -0.108577974, 'GA': -0.039598722, 'GC': 0.095519987, 'GG': 0.049224694, 'GU': 0.060115731, 'UA': 0.043641921, 'UC': 0.068869986, 'UG': 0.143892551, 'UU': 0.150923932},
    {'AA': -0.094417048, 'AC': -0.016465339, 'AG': 0.007966314, 'AU': -0.070465864, 'CA': -0.034399076, 'CC': 0.088154422, 'CG': 0.101680984, 'CU': 0.018424432, 'GA': -0.013355767, 'GC': 0.063964234, 'GG': 0.046869673, 'GU': 0.079379173, 'UA': -0.002714079, 'UC': 0.009395615, 'UG': 0.063370269, 'UU': 0.04770594},
    {'AA': -0.05058309, 'AC': -0.075775455, 'AG': -0.109548632, 'AU': 0.013196108, 'CA': 0.011969527, 'CC': 0.010987723, 'CG': -0.045403135, 'CU': 0.068804131, 'GA': 0.036976505, 'GC': 0.041290001, 'GG': 0.061370459, 'GU': 0.103596682, 'UA': 0.008931228, 'UC': -0.051668893, 'UG': -0.02844665, 'UU': 0.057774192},
    {'AA': -0.01682109, 'AC': 0.01210296, 'AG': -0.02912992, 'AU': -0.000007130785, 'CA': -0.02917609, 'CC': -0.03138277, 'CG': -0.07195967, 'CU': -0.008602885, 'GA': -0.07141928, 'GC': -0.05316172, 'GG': -0.03232449, 'GU': -0.04321265, 'UA': 0.06265714, 'UC': 0.04426281, 'UG': 0.03251295, 'UU': 0.04934783},
    {'AA': -0.010695708, 'AC': -0.00902432, 'AG': 0.012377923, 'AU': 0.009006838, 'CA': 0.013777801, 'CC': -0.003837145, 'CG': 0.013297102, 'CU': -0.009253344, 'GA': -0.022117792, 'GC': -0.031887997, 'GG': -0.002909972, 'GU': -0.03805112, 'UA': 0.034444806, 'UC': -0.009542745, 'UG': 0.032088368, 'UU': 0.006159874},
]

# Log2 Fold-Changes
# Dinucleotide model
R4b_di = [
    {'AA': -0.005433769, 'AC': -0.003965332, 'AG': -0.0003775447, 'AU': 0.001430999, 'CA': 0.01088227, 'CC': 0.001501639, 'CG': -0.002819773, 'CU': 0.01317336, 'GA': -0.006397201, 'GC': -0.0202702, 'GG': -0.008585581, 'GU': -0.004252534, 'UA': 0.02323227, 'UC': -0.000004352105, 'UG': 0.01412205, 'UU': 0.01770772},
    {'AA': 0.0042834876, 'AC': -0.0131270204, 'AG': 0.0142523519, 'AU': -0.0042520103, 'CA': -0.0005771547, 'CC': -0.0292780898, 'CG': -0.0022027671, 'CU': -0.0021681812, 'GA': 0.0118728021, 'GC': -0.0208115596, 'GG': 0.0046693018, 'GU': -0.0084865441, 'UA': 0.0120472279, 'UC': -0.0073481328, 'UG': 0.0129235148, 'UU': -0.0124365496},
    {'AA': 0, 'AC': 0.03484197, 'AG': -0.007480984, 'AU': 0, 'CA': 0, 'CC': 0.008212147, 'CG': -0.032077217, 'CU': 0, 'GA': 0, 'GC': 0.01434027, 'GG': 0.00366422, 'GU': 0, 'UA': 0, 'UC': 0.015023827, 'UG': -0.016716362, 'UU': 0},
    {'AA': 0, 'AC': 0, 'AG': 0, 'AU': 0, 'CA': 0, 'CC': 0.018770994, 'CG': 0, 'CU': 0, 'GA': 0, 'GC': -0.009842453, 'GG': 0, 'GU': 0, 'UA': 0, 'UC': 0, 'UG': 0, 'UU': 0},
    {'AA': 0, 'AC': 0, 'AG': 0, 'AU': 0, 'CA': -0.011144808, 'CC': 0.006235185, 'CG': -0.028542785, 'CU': 0.059238522, 'GA': 0, 'GC': 0, 'GG': 0, 'GU': 0, 'UA': 0, 'UC': 0, 'UG': 0, 'UU': 0},
    {'AA': -0.009522305, 'AC': 0.062748291, 'AG': -0.074673607, 'AU': 0.045505634, 'CA': 0.019866681, 'CC': 0.036813409, 'CG': -0.048494666, 'CU': 0.061439031, 'GA': -0.024059662, 'GC': 0.042361668, 'GG': -0.106397757, 'GU': 0.038453389, 'UA': 0.082731471, 'UC': 0.093607182, 'UG': -0.002642735, 'UU': 0.122115793},
    {'AA': 0.072130987, 'AC': 0.126789177, 'AG': -0.071779421, 'AU': 0.039005913, 'CA': 0.112734937, 'CC': 0.103896886, 'CG': -0.036089654, 'CU': 0.126049786, 'GA': -0.00503588, 'GC': 0.037128607, 'GG': -0.177483795, 'GU': -0.004292496, 'UA': 0.130425552, 'UC': 0.141686594, 'UG': -0.033763896, 'UU': 0.120970014},
    {'AA': 0.1267688294, 'AC': 0.1461437685, 'AG': -0.0060930033, 'AU': 0.1020504489, 'CA': 0.1664675358, 'CC': 0.0820432081, 'CG': 0.0078608519, 'CU': 0.1214791035, 'GA': -0.0662179231, 'GC': 0.0001916755, 'GG': -0.1673329525, 'GU': -0.0978607476, 'UA': 0.1438499459, 'UC': 0.115182071, 'UG': -0.0249303414, 'UU': 0.0617152358},
    {'AA': 0.011363718, 'AC': 0.162159634, 'AG': 0.065834431, 'AU': 0.090197303, 'CA': 0.023867952, 'CC': 0.139220915, 'CG': 0.042339635, 'CU': 0.081918838, 'GA': -0.154121101, 'GC': 0.052317918, 'GG': -0.106955224, 'GU': -0.074362022, 'UA': -0.016044997, 'UC': 0.121599896, 'UG': -0.009859235, 'UU': -0.005222877},
    {'AA': -0.18538821, 'AC': 0.04588116, 'AG': 0.01515899, 'AU': -0.10922156, 'CA': -0.01242086, 'CC': 0.21498211, 'CG': 0.15221119, 'CU': 0.04447931, 'GA': -0.19828033, 'GC': 0.0388746, 'GG': 0.05023473, 'GU': -0.10099033, 'UA': -0.098102, 'UC': 0.10164178, 'UG': 0.0499366, 'UU': -0.08899389},
    {'AA': -0.16348208, 'AC': -0.20509574, 'AG': -0.0817777, 'AU': -0.03617314, 'CA': 0.04442879, 'CC': -0.00635486, 'CG': 0.08093335, 'CU': 0.2069162, 'GA': 0.03502903, 'GC': -0.08623692, 'GG': 0.17994785, 'GU': 0.14524248, 'UA': -0.13255233, 'UC': -0.16083653, 'UG': -0.06925341, 'UU': 0.07600838},
    {'AA': -0.03856405, 'AC': -0.0817389, 'AG': 0.03034085, 'AU': -0.02909581, 'CA': -0.22519636, 'CC': -0.01584372, 'CG': -0.04598857, 'CU': -0.14804715, 'GA': -0.0157952, 'GC': 0.07971978, 'GG': 0.05797816, 'GU': 0.09016484, 'UA': 0.05628669, 'UC': 0.06752028, 'UG': 0.15341265, 'UU': 0.18025393},
    {'AA': -0.149361809, 'AC': -0.045611282, 'AG': 0.002040677, 'AU': -0.116448795, 'CA': -0.065117058, 'CC': 0.066876833, 'CG': 0.08726532, 'CU': -0.004805387, 'GA': -0.024273441, 'GC': 0.060579975, 'GG': 0.051906268, 'GU': 0.06890931, 'UA': -0.022079335, 'UC': -0.006992164, 'UG': 0.059492085, 'UU': 0.026954761},
    {'AA': -0.077219692, 'AC': -0.104644007, 'AG': -0.110411569, 'AU': 0.006404936, 'CA': 0.015147464, 'CC': 0.011610443, 'CG': -0.063182316, 'CU': 0.087041447, 'GA': 0.058617309, 'GC': 0.018986939, 'GG': 0.045972052, 'GU': 0.111802725, 'UA': 0.006050205, 'UC': -0.062854824, 'UG': -0.054688374, 'UU': 0.059708054},
    {'AA': -0.015567376, 'AC': 0.031495467, 'AG': -0.017962542, 'AU': 0.006821267, 'CA': -0.028647697, 'CC': -0.008439025, 'CG': -0.063004892, 'CU': -0.00792387, 'GA': -0.044690048, 'GC': -0.059867284, 'GG': -0.037411787, 'GU': -0.06880036, 'UA': 0.071322068, 'UC': 0.069002871, 'UG': 0.063014776, 'UU': 0.059339477},
]

def pred_rnaseh_di(target_seq: str, di_nt_model) -> Dict:
    """
    Predict cleavage sites for RNASeH1 using position weight matrix of di-nucleotide model.
    Prediction of downregulation activity of RNAse H1 described in the paper:
    RNase H sequence preferences influence antisense oligonucleotide efficiency
    Ł. J. Kiełpiński, P. H. Hagedorn, M. Lindow and J. Vinther
    Nucleic Acids Research 2017 Vol. 45 Issue 22 Pages 12932-12944
    DOI: 10.1093/nar/gkx1073
    
    target: RNA molecule or transcript
    di_nt_model: position weight matrix
    """
    target_seq = target_seq.replace('T', 'U')
    num_kmers = len(target_seq) - len(di_nt_model)
    res = {}
    for i in range(num_kmers):
        scoring_seq = target_seq[i:i+len(di_nt_model)+1]
        score = 0
        for idx in range(len(di_nt_model)):
            pair = scoring_seq[idx:idx+2]
            normalizer = 0.75 if idx == 0 or idx == len(scoring_seq) - 2 else 0.5
            score += di_nt_model[idx][pair] * normalizer
        res[i] = score
    return res